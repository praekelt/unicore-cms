<div xmlns:metal="http://xml.zope.org/namespaces/metal"
     metal:define-macro="comment_form"
     class="add-comment"
     id="add-comment"
     tal:condition="exists:comments.state"
     tal:switch="comments.state">

    <div tal:case="'open'" tal:omit-tag="" tal:define="user view.request.user">

        <div tal:switch="bool(user)" tal:omit-tag="">

          <form action="${request.route_url('comments', uuid=page.uuid, _query=request.GET)}" method="post" tal:case="True">
            <div tal:define="error comment_form.error" metal:use-macro="view.form_utils['errors']"></div>
            <div tal:repeat="field comment_form" metal:use-macro="view.form_utils['field']"></div>
            <input name="submit" type="submit" tal:attributes="value 'Add comment'" i18n:attributes="value" class="btn btn-wide" />
          </form>

          <p tal:case="False">
            <span i18n:translate="" tal:omit-tag="">You have to be signed in to add a comment</span>. <a href="${request.route_url('redirect_to_login')}" i18n:translate="">Sign in here</a>.
          </p>

        </div>

    </div>

    <p tal:case="'closed'" i18n:translate="">Commenting has been closed.</p>

</div
