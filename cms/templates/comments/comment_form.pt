<div xmlns:metal="http://xml.zope.org/namespaces/metal"
     metal:define-macro="comment_form"
     class="add-comment"
     id="add-comment"
     tal:condition="exists:comments.state"
     tal:switch="comments.state">

    <div tal:case="'open'" tal:omit-tag="" tal:define="user view.request.user">

        <div tal:switch="bool(user)" tal:omit-tag="">

          <form action="${request.route_url('comments', uuid=page.uuid, _query=request.GET)}" method="post" tal:case="True">
            <div tal:repeat="field comment_form" tal:omit-tag="">
                <div tal:condition="field.widget.hidden" tal:omit-tag="">${structure:field.render()}</div>
            </div>

            <label for="${comment_form.comment.name}">
                <span i18n:translate="" tal:omit-tag="">Add your comment</span>
                ${structure:comment_form.comment.render()}
            </label>
            <ul class="error-list" tal:define="c comment_form.comment" tal:condition="c.error">
                <li class="error" tal:repeat="msg c.error.messages()" i18n:translate="">${msg}</li>
            </ul>

            <input name="submit" type="submit" tal:attributes="value 'Comment'" i18n:attributes="value" class="btn btn-wide" />
          </form>

          <p tal:case="False">
            <span i18n:translate="" tal:omit-tag="">You have to be signed in to add a comment</span>. <a href="${request.route_url('redirect_to_login')}" i18n:translate="">Sign in here</a>.
          </p>

        </div>

    </div>

    <p tal:case="'closed'" i18n:translate="">Commenting has been closed.</p>

</div
